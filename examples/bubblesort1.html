<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Bubblesort</title>

    <script src="../build/inalan20150721.js"></script>

    <script>

    var init = function () {

        var stage = new inalan.Stage("myCanvas");
        stage.showAllButtons();

        var a = new inalan.VisuArray("a", [0, 0, 0, 0, 0, 0, 0], true);
        a.setMinValue(5);
        a.randomize(30, 150);
        a.x = 80;
        a.y = 220;
        stage.addVisu(a, "a");

        var label = new inalan.VisuLabel(["This animation shows the bubblesort algorithm. We compare every element with its right neightbour.",
                                          "If the compared elements are not in ascending order, we exchange them."]);
        label.x = 30;
        label.y = 350;
        stage.addVisu(label, "label")

        var c = new inalan.VisuCode(["FOR i = 6 downto 1",
                                     "   FOR j = 0 to i-1",
                                     "      IF a[j] > a[j+1] THEN",
                                     "         exchange a[j] a[j+1]",
                                     "      END IF",
                                     "   END FOR",
                                     "END FOR"]);
        c.x = 310;
        c.y = 60;
        stage.addVisu(c, "code"); // in code we can refer to this with id = "code"

        // **********************************************

        // functions (steps of the animation) ...
        // global vars need to be stored in stage.vars object...

        var setI = function () {
            stage.vars.i = 6;
            stage.get("code").selected = [0];
            stage.get("a").setIndex("i", stage.vars.i, 1);
            return 200;
        }

        var setJ = function () {
            stage.vars.j = 0;
            stage.get("code").selected = [1];
            stage.get("a").setIndex("j", stage.vars.j, 0);
            stage.get("a").setIndex("j+1", stage.vars.j+1, 0);
            return 200;
        }

        var compare = function () {
            stage.get("code").selected = [2];
            stage.compare(stage.get("a").items[stage.vars.j], stage.get("a").items[stage.vars.j+1]);
        }

        var exchange = function () {
            if (stage.get("a").items[stage.vars.j].value > stage.get("a").items[stage.vars.j+1].value) {
                stage.get("code").selected = [3];
                for (var k = 0; k <= stage.vars.j + 1; k++) {
                    stage.get("a").items[k].maxValue = stage.get("a").items[stage.vars.j].value;
                }
                stage.exchange(stage.get("a").items[stage.vars.j], stage.get("a").items[stage.vars.j+1]);
            } else {
                for (var k = 0; k <= stage.vars.j + 1; k++) {
                    stage.get("a").items[k].maxValue = stage.get("a").items[stage.vars.j + 1].value;                    
                }                
                return 0;
            }
        }

        var decI = function () {
            stage.get("a").items[stage.vars.i].setGreenColor();
            stage.get("a").items[stage.vars.i].changable = false;
            stage.vars.i--;
            if (checkI()) {
                stage.get("code").selected = [0];
                stage.get("a").setIndex("i", stage.vars.i, 1);
                return 200;
            } else {
                stage.get("a").deleteIndex("i");                
                return 0;
            }
        }

        var incJ = function () {
            stage.vars.j++;
            if (checkJ()) {
                stage.get("code").selected = [1];
                stage.get("a").setIndex("j", stage.vars.j, 0);
                stage.get("a").setIndex("j+1", stage.vars.j + 1, 0);
                return 200;
            } else {
                stage.get("a").deleteIndex("j");
                stage.get("a").deleteIndex("j+1");
                return 0;
            }
        }

        var makeChangable = function () {
            stage.get("a").items[stage.vars.j].changable = true;
            return 0;
        }

        var checkI = function () {
            return stage.vars.i > 0;
        }

        var checkJ = function () {
            return stage.vars.j < stage.vars.i;
        }

        var finalStep = function () {
            stage.get("a").items[0].setGreenColor();
            stage.get("a").items[0].changable = false;
            stage.get("code").selected = [];
        }

        // defining steps in animation...
        stage.setSteps([
            setI,
            [
                setJ,
                [
                    compare,
                    exchange,
                    makeChangable,
                    incJ
                ], checkJ,
                decI
            ], checkI,
            finalStep
        ]);

    }

    </script>


</head>
<body onload="init();">

    <canvas id="myCanvas" width="700" height="480" style="border:1px solid black"></canvas>

</body>
</html>
