<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Test page</title>
        
    <script src="src/Stage.js"></script>
    <script src="src/Controller.js"></script>
    <script src="src/VisuData.js"></script>        
    <script src="src/VisuVariable.js"></script>
    <script src="src/VisuArray.js"></script>
    <script src="src/VisuButton.js"></script>    
    <script src="src/VisuScrollbar.js"></script>    
    <script src="src/VisuLabel.js"></script>
    <script src="src/VisuCode.js"></script>
    
    <script>        

        var init = function () {

            var stage = new inalan.Stage("myCanvas");
            stage.showAllButtons();

            var m = new inalan.VisuVariable("max", 0, false);
            m.x = 45;
            m.y = 220;
            stage.add(m);

            var a = new inalan.VisuArray("a", [0, 0, 0, 0, 0, 0, 0], true);
            a.randomize(30,150);
            a.x = 100;
            a.y = 220;
            stage.add(a);

            var i = new inalan.VisuLabel("info", ["This animation shows how to find the maximum in an array. In the beginning, we copy the first element",
                                                  "of the array to the maximum. Next, we compare the maximum with every other element in the array.",
                                                  "If any of the compared element in the array is bigger than the maximum, we copy it to the maximum."]);
            i.x = 30;
            i.y = 330;
            stage.add(i)

            var c = new inalan.VisuCode("code", ["max = a[0]",
                                                 "FOR i = 1 to 6",
                                                 "   IF a[i] > max THEN",
                                                 "      max = a[i]",
                                                 "   END IF",
                                                 "END FOR"]);
            c.x = 360;
            c.y = 70;
            stage.add(c);

            // **********************************************

            // global variables used in functions (for undo function need to be stored in stage.var object) ...
            stage.var.index = 0;

            // functions (steps of the animation) ...
            var findMaxFirstStep = function () {
                // select the first line in the code
                stage.get("code").selected = [0];
                // copy first element to max
                stage.copy(stage.get("a").items[0], stage.get("max"));
            }

            var findMaxCompare = function () {
                // select a line in the code
                stage.get("code").selected = [2];
                // compare max with the next element
                stage.compare(stage.get("max"), stage.get("a").items[stage.var.index]);                
            }

            var findMaxCopy = function () {
                // set default colours (after comparing)
                stage.get("max").setDefaultColor();
                stage.get("a").items[stage.var.index].setDefaultColor();
                // copy the element to max if it is bigger     
                if (stage.get("max").value < stage.get("a").items[stage.var.index].value) {
                    stage.get("code").selected = [3];
                    stage.copy(stage.get("a").items[stage.var.index], stage.get("max"));
                } else {
                    stage.get("a").items[stage.var.index].changable = false;                    
                    return 0; // automatically jump to the next step after 0ms...
                }
            }

            var findMaxIncrease = function () {
                // set default colours (after copying)
                stage.get("max").setDefaultColor();
                stage.get("a").items[stage.var.index].setDefaultColor();
                // increase the stage.var.index (go to next element)
                stage.var.index++;
                // set index "i" in array
                stage.get("a").setIndex("i", stage.var.index);
                // select a line in the code
                if (findMaxCheck()) {
                    stage.get("code").selected = [1];                    
                    return 200; // automatically jump to the next step after 200ms (if normal speed is selected)...
                } else {                    
                    return 0; // automatically jump to the next step after 0ms...
                }                                               
            }

            var findMaxCheck = function () {
                // check if there are more elements in array (array is indexed from 0)
                return stage.var.index < stage.get("a").items.length;
            }

            var findMaxFinalStep = function () {
                // deselect all lines in the code
                stage.get("code").selected = [];
                // remove index "i" from stage
                stage.get("a").deleteIndex("i");
            }
             
            // defining steps in animation...
            stage.setSteps([
                findMaxFirstStep,
                findMaxIncrease,
                [findMaxCompare, findMaxCopy, findMaxIncrease], findMaxCheck,
                findMaxFinalStep
            ]);

            // stage.get("max").setDefaultColor();
            // stage.get("a").setIndex("i", 1);
            // stage.compare(stage.get("a").items[0], stage.get("a").items[3]);
            // stage.copy(stage.get("a").items[2], stage.get("max"));
            // stage.move(stage.get("a").items[2], stage.get("max"));
            // stage.exchange(stage.get("a").items[0], stage.get("a").items[6]);

        }

    </script>

</head>
<body onload="init();">

    <canvas id="myCanvas" width="700" height="480" style="border:1px solid black"></canvas>
    
</body>
</html>
