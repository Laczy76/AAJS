<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Test page</title>
        
    <script src="src/Stage.js"></script>
    <script src="src/Controller.js"></script>
    <script src="src/VisuData.js"></script>        
    <script src="src/VisuVariable.js"></script>
    <script src="src/VisuArray.js"></script>
    <script src="src/VisuButton.js"></script>    
    <script src="src/VisuScrollbar.js"></script>    
    <script src="src/VisuLabel.js"></script>
    
    <script>        

        var init = function () {

            var stage = new inalan.Stage("myCanvas");
            stage.controller.showAllButtons();

            var m = new inalan.VisuVariable("max", 0, false);
            m.x = 45;
            m.y = 220;
            stage.add(m);

            var a = new inalan.VisuArray("a", [0, 0, 0, 0, 0, 0, 0], true);
            a.randomize(30,150);
            a.x = 100;
            a.y = 220;
            stage.add(a);

            var i = new inalan.VisuLabel("info", "This animation shows how to find the maximum value in an array.");
            i.x = 30;
            i.y = 310;
            stage.add(i)            

            // **********************************************

            // variables (for undo function need to be stored in stage.var object) ...
            stage.var.index = 0;

            // functions (steps of the animation) ...
            var findMaxReset = function () {
                stage.var.index = 0;
                stage.get("max").value = 0;
                stage.get("max").setDefaultColor();
                for (var i = 0; i < stage.get("a").items.length; i++) {
                    stage.get("a").items[i].setDefaultColor();
                    stage.get("a").items[i].changable = true;
                }
                stage.get("a").deleteIndex("i");
            }

            var findMaxFirstStep = function () {
                // copy first element to max
                stage.get("a").items[0].changable = false;
                stage.copy(stage.get("a").items[0], stage.get("max"));
            }

            var findMaxCompare = function () {                
                // compare max with the next element
                stage.compare(stage.get("max"), stage.get("a").items[stage.var.index]);
                stage.get("a").setIndex("i", stage.var.index);
            }

            var findMaxCopy = function () {
                // copy the element to max if it is bigger
                stage.get("a").items[stage.var.index].changable = false;
                if (stage.get("max").value < stage.get("a").items[stage.var.index].value) {
                    stage.copy(stage.get("a").items[stage.var.index], stage.get("max"));
                } else {
                    return true; // automatically run the next step
                }
            }

            var findMaxIncrease = function () {
                // increase the stage.var.index (go to next element)
                stage.get("max").setDefaultColor();
                stage.get("a").items[stage.var.index].setDefaultColor();
                stage.var.index++;
                return true;
            }

            var findMaxCheck = function () {
                // check if there are more elements in array
                return stage.var.index < stage.get("a").items.length;
            }

            var findMaxFinalStep = function () {
                stage.get("a").deleteIndex("i");
            }
                   
            // defining reset function and steps in animation...
            stage.controller.setReset(findMaxReset);
            stage.controller.setSteps([
                findMaxFirstStep,
                findMaxIncrease,
                [findMaxCompare, findMaxCopy, findMaxIncrease], findMaxCheck,
                findMaxFinalStep
            ]);

            // stage.get("max").setDefaultColor();
            // stage.get("a").setIndex("i", 1);
            // stage.compare(stage.get("a").items[0], stage.get("a").items[3]);
            // stage.copy(stage.get("a").items[2], stage.get("max"));
            // stage.move(stage.get("a").items[2], stage.get("max"));
            // stage.exchange(stage.get("a").items[0], stage.get("a").items[6]);

        }

    </script>

</head>
<body onload="init();">

    <canvas id="myCanvas" width="800" height="420" style="border:1px solid black"></canvas>
    
</body>
</html>
