<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Test page</title>
    
    <script src="src/Stage.js"></script>
    <script src="src/VisuData.js"></script>        
    <script src="src/VisuVariable.js"></script>
    <script src="src/VisuArray.js"></script>
    <script src="src/Button.js"></script>
    <script src="src/Scrollbar.js"></script>
    <script src="src/Controller.js"></script>
    
    <script>        

        var init = function () {

            var stage = new inalan.Stage("myCanvas");

            var m = new inalan.VisuVariable("max", 0, false);
            m.x = 50;
            m.y = 200;
            stage.add(m);

            var a = new inalan.VisuArray("a", [80, 90, 30, 70, 40, 100, 110], true);
            a.randomize(30,100);
            a.x = 100;
            a.y = 200;
            stage.add(a);

            // **********************************************

            var index = 0;

            var findMaxReset = function () {
                index = 0;
                stage.get("max").value = 0;
                stage.get("max").setDefaultColor();
                for (var i = 0; i < stage.get("a").items.length; i++) {
                    stage.get("a").items[i].setDefaultColor();
                    stage.get("a").items[i].changable = true;
                }
                stage.get("a").deleteIndex("i");
            }

            var findMaxFirstStep = function () {
                // copy first element to max
                console.log("first step");
                stage.get("a").items[0].changable = false;
                stage.copy(stage.get("a").items[0], stage.get("max"));
            }

            var findMaxCompare = function () {
                // compare max with the next element
                console.log("compare");
                stage.compare(stage.get("max"), stage.get("a").items[index]);
                stage.get("a").setIndex("i", index);
            }

            var findMaxCopy = function () {
                // copy the element to max if it is bigger
                console.log("copy");
                stage.get("a").items[index].changable = false;
                if (stage.get("max").value < stage.get("a").items[index].value) {                    
                    stage.copy(stage.get("a").items[index], stage.get("max"));
                } else {
                    return true;
                }
            }

            var findMaxIncrease = function () {
                // increase the index (go to next element)
                console.log("increase");
                stage.get("max").setDefaultColor();
                stage.get("a").items[index].setDefaultColor();
                index++;
                return true;
            }

            var findMaxCheck = function () {
                // check if there are more elements in array
                return index < stage.get("a").items.length;
            }

            var findMaxFinalStep = function () {
                stage.get("a").deleteIndex("i");
            }
            
            stage.controller.setReset(findMaxReset);
            stage.controller.setSteps([
                findMaxFirstStep,
                findMaxIncrease,
                [findMaxCompare, findMaxCopy, findMaxIncrease], findMaxCheck,
                findMaxFinalStep
            ]);

            // stage.get("max").setDefaultColor();
            // stage.get("a").setLabel("i", 1);
            // stage.compare(stage.get("a").items[0], stage.get("a").items[3]);
            // stage.copy(stage.get("a").items[2], stage.get("max"));
            // stage.move(stage.get("a").items[2], stage.get("max"));
            // stage.exchange(stage.get("a").items[0], stage.get("a").items[6]);

        }

    </script>

</head>
<body onload="init();">

    <canvas id="myCanvas" width="800" height="500" style="border:1px solid black"></canvas>
    
</body>
</html>
